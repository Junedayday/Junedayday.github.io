<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta name="description" content="2022-03-11 Go垃圾回收之旅（二）Go静态编译Go的源码会被编译成二进制文件，然后直接在对应的操作系统上运行。我们一般会拿JAVA程序对比：  Go: Linux -&gt; 二进制文件 JAVA:  Linux -&gt; JVM -&gt;  JAR包  我们常谈到的 运行时，Go语言是直接编译成二进制、放到二进制文件里的；而JAVA是在JVM里实现的。Go的主要优劣点如下：  优">
<meta property="og:type" content="article">
<meta property="og:title" content="五分钟技术小分享 - 2022Week11">
<meta property="og:url" content="http://example.com/2022/03/11/sharing-5min/2022-03/2022Week11/index.html">
<meta property="og:site_name" content="Junedayday Blog">
<meta property="og:description" content="2022-03-11 Go垃圾回收之旅（二）Go静态编译Go的源码会被编译成二进制文件，然后直接在对应的操作系统上运行。我们一般会拿JAVA程序对比：  Go: Linux -&gt; 二进制文件 JAVA:  Linux -&gt; JVM -&gt;  JAR包  我们常谈到的 运行时，Go语言是直接编译成二进制、放到二进制文件里的；而JAVA是在JVM里实现的。Go的主要优劣点如下：  优">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cloud-fitter-1305666920.cos.ap-beijing.myqcloud.com/57591641299799_.pic_hd.jpg">
<meta property="og:image" content="https://i.loli.net/2021/02/28/RPzy7Hjc9GZ8I3e.jpg">
<meta property="article:published_time" content="2022-03-11T04:00:00.000Z">
<meta property="article:modified_time" content="2022-03-11T15:08:10.063Z">
<meta property="article:author" content="Junedayday">
<meta property="article:tag" content="Daily-Sharing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cloud-fitter-1305666920.cos.ap-beijing.myqcloud.com/57591641299799_.pic_hd.jpg">


<link rel="canonical" href="http://example.com/2022/03/11/sharing-5min/2022-03/2022Week11/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>五分钟技术小分享 - 2022Week11 | Junedayday Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Junedayday Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">六月天天的个人博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2022-03-11-Go%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B9%8B%E6%97%85%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">2022-03-11 Go垃圾回收之旅（二）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Go%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91"><span class="nav-number">1.1.</span> <span class="nav-text">Go静态编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E9%AB%98%E5%B3%B0%E6%9C%9F%E7%9A%84Go%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.2.</span> <span class="nav-text">业务高峰期的Go程序</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Junedayday</p>
  <div class="site-description" itemprop="description">Blog信息</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">87</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/11/sharing-5min/2022-03/2022Week11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Junedayday">
      <meta itemprop="description" content="Blog信息">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Junedayday Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          五分钟技术小分享 - 2022Week11
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-03-11 12:00:00 / 修改时间：23:08:10" itemprop="dateCreated datePublished" datetime="2022-03-11T12:00:00+08:00">2022-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%AF%8F%E6%97%A5%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" itemprop="url" rel="index"><span itemprop="name">每日技术分享</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><img src="https://cloud-fitter-1305666920.cos.ap-beijing.myqcloud.com/57591641299799_.pic_hd.jpg" alt="2020-03"></p>
<h2 id="2022-03-11-Go垃圾回收之旅（二）"><a href="#2022-03-11-Go垃圾回收之旅（二）" class="headerlink" title="2022-03-11 Go垃圾回收之旅（二）"></a>2022-03-11 Go垃圾回收之旅（二）</h2><h3 id="Go静态编译"><a href="#Go静态编译" class="headerlink" title="Go静态编译"></a>Go静态编译</h3><p>Go的源码会被编译成二进制文件，然后直接在对应的操作系统上运行。我们一般会拿JAVA程序对比：</p>
<ul>
<li><strong>Go</strong>: Linux -&gt; 二进制文件</li>
<li><strong>JAVA</strong>:  Linux -&gt; JVM -&gt;  JAR包</li>
</ul>
<p>我们常谈到的 运行时，Go语言是直接编译成二进制、放到二进制文件里的；而JAVA是在JVM里实现的。Go的主要优劣点如下：</p>
<ul>
<li>优点： 程序的运行更具备 <strong>确定性</strong>，即编码人员可以预期到程序的运行逻辑，对应性地优化</li>
<li>缺点：运行时没有JIT机制，无法针对具体的运行结果进行反馈优化</li>
</ul>
<p>简单地说：Go程序会怎么运行，往往在编码阶段就可以预期到了；而JAVA引入的JIT能力，可以在程序运行后，根据具体的对象创建频率等情况，做针对性地优化。</p>
<p>孰优孰劣，看团队的具体选择。单针对Go语言开发者来说，排查线上问题相对有JIT机制的JAVA程序简单很多；同时，Go的GC也相对更具备确定性。</p>
<h3 id="业务高峰期的Go程序"><a href="#业务高峰期的Go程序" class="headerlink" title="业务高峰期的Go程序"></a>业务高峰期的Go程序</h3><blockquote>
<p>Out of memory, OOMs, are tough on Go; </p>
<p>temporary spikes in memory usage should be handled by increasing CPU costs, not by aborting. </p>
<p>Basically if the GC sees memory pressure it informs the application that it should shed load. Once things are back to normal the GC informs the application that it can go back to its regular load.</p>
</blockquote>
<p>这段话包含了Go语言GC时，在CPU和内存的决策：</p>
<ol>
<li><strong>Go程序很少会OOM</strong><ol>
<li>这句话有一定前提，即内存设置是合理的</li>
</ol>
</li>
<li><strong>业务高峰时内存使用率过高，应该通过提升CPU能力来解决，而不是停止</strong><ol>
<li>CPU是对内存使用率有帮助的，因为GC是需要CPU资源进行计算的</li>
<li>要保证内存能支持程序，主要分两个思路<ol>
<li>清理已有的内存 - 通过GC来清理无用的内存</li>
<li>限制新增的内存 - 即运行时尽可能地避免新内存的产生，最简单的方法就是不运行代码</li>
</ol>
</li>
</ol>
</li>
<li><strong>GC压力高时，通知应用减少负载；而当恢复正常后，GC再通知应用可以恢复到正常模式了</strong><ol>
<li>我们可以将上述分为两类工作<ol>
<li>业务逻辑的Goroutine</li>
<li>GC的Goroutine</li>
</ol>
</li>
<li>这两类Goroutine都会消耗CPU资源，区别在于运行业务逻辑往往会增加内存，而GC是回收内存</li>
<li>这里就能体现出Go运行时的一个策略：内存压力会让GC更容易抢占到资源，代价是业务处理逻辑会有一定性能损耗；也就是说，Go更追求程序的可靠性</li>
</ol>
</li>
</ol>
<blockquote>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/Junedayday/code_reading">https://github.com/Junedayday/code_reading</a></p>
<p>Blog: <a target="_blank" rel="noopener" href="http://junes.tech/">http://junes.tech/</a></p>
<p>Bilibili: <a target="_blank" rel="noopener" href="https://space.bilibili.com/293775192">https://space.bilibili.com/293775192</a></p>
<p>公众号: golangcoding</p>
<p> <img src="https://i.loli.net/2021/02/28/RPzy7Hjc9GZ8I3e.jpg" alt="二维码"></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Daily-Sharing/" rel="tag"># Daily-Sharing</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/07/sharing-5min/2022-03/2022Week10/" rel="prev" title="五分钟技术小分享 - 2022Week10">
                  <i class="fa fa-chevron-left"></i> 五分钟技术小分享 - 2022Week10
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Junedayday</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class=BbeiAn-info">
  浙ICP备 -
  <a target="_blank" rel="noopener" href="http://www.miitbeian.gov.cn/">19051676号-1</a>
  </a>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  















  








  

  

</body>
</html>
